81,83d80
< #  warn $self->feature,": x1=$x1, x2=$x2, start=$self->{start},end=$self->{end}, strand=$self->{strand}";
< #  warn join ' ',%$self;
< 
96d92
<     local $^W = 0;  # dumb uninitialized variable warning
101,115c97,123
< 
<     my $relative               = $self->option('relative_coords');
<     my $reversed = exists $self->{flip} || ($relative && $self->feature->strand < 0);
<     my $relative_coords_offset = $self->option('relative_coords_offset');
<     $relative_coords_offset    = 1 unless defined $relative_coords_offset;
< 
<     my $start    = $relative ? $relative_coords_offset : $self->feature->start-1;
<     my $stop     = $start + $self->feature->length - 1;
< 
<     # WARNING: THIS IS NOT WELL THOUGHT OUT, REVERSED SEGMENTS MAY NOT INTERACT
<     # WITH RELATIVE COORDINATES OFFSET CORRECTLY
<     my $offset   = $relative ? 
<                    $reversed ? ($self->feature->end   - $relative_coords_offset) 
<                              : ($self->feature->start - $relative_coords_offset) 
< 	          : 0;
---
>     
>     # FLAGS NO MORE HANDLED (Because they were simply not working)
>     # relative_coords, relative_coords_offset
>     # It seems these flags were added as a patch to the previous problems
>     
>     # my $relative               = $self->option('relative_coords');
>     # my $reversed = exists $self->{flip} || ($relative && $self->feature->strand < 0);
>     # my $relative_coords_offset = $self->option('relative_coords_offset');
>     # $relative_coords_offset    = 1 unless defined $relative_coords_offset;
>     my $flip = exists $self->{flip};
>   
>     #my $start    = $relative ? $relative_coords_offset : $self->feature->start-1+1; #WAS -1, WE MUST DO +1
>     #my $stop     = $start + $self->feature->length - 1;
>     
>     my $start = $self->feature->start;
>     my $stop  = $self->feature->end;
> 
>     # # WARNING: THIS IS NOT WELL THOUGHT OUT, REVERSED SEGMENTS MAY NOT INTERACT
>     # # WITH RELATIVE COORDINATES OFFSET CORRECTLY
>     # my $offset   = $relative ? 
>                    # $reversed ? ($self->feature->end   - $relative_coords_offset) 
>                              # : ($self->feature->start - $relative_coords_offset) 
> 	          # : 0;
>     my $offset = 0;
>     if ($flip && ($self->panel->end > $self->feature->end)) {
>         $offset = $self->panel->end - $self->feature->end;
>     }
145c153
<     my $last_tick  = $major_interval * int(0.5 + $stop/$major_interval);
---
>     my $last_tick  = $major_interval * int(0.5 + $stop/$major_interval)+1; # WE MUST DO +1
148,150c156,159
< 
<       my $tickpos = $dx + ($reversed ? $self->map_pt($stop - $i + $offset)
< 	                             : $self->map_pt($i + $offset));
---
>       # my $tickpos = $dx + ($reversed ? $self->map_pt($stop - $i + $offset)  
> 	                                 # : $self->map_pt($i + $offset));
>       my $tickpos = $dx + ($flip ? $self->map_pt($stop - $i + $offset + 2) # WE MUST DO +2
>                                  : $self->map_pt($i + $offset));
152c161
< 
---
>       
159c168
<       next if $middle < $left or $middle > $right;
---
>       #next if $middle < $left or $middle > $right; #There is problems with this
168c177
<       $last_tick  = $minor_interval * int(0.5 + $stop/$minor_interval);
---
>       $last_tick  = ($minor_interval * int(0.5 + $stop/$minor_interval))+1; # WE MUST DO +1
171,174c180,185
<       for (my $i = $first_tick; $i <= $last_tick; $i += $minor_interval) {
< 	my $tickpos = $dx + ($reversed ? $self->map_pt($stop - $i + $offset)
< 	                               : $self->map_pt($i + $offset));
< 	next if $tickpos < $left or $tickpos > $right;
---
>       for (my $i = $first_tick; $i <= $last_tick; $i += $minor_interval) { 
> 	    # my $tickpos = $dx + ($reversed ? $self->map_pt($stop - $i + $offset)
> 	                                   # : $self->map_pt($i + $offset));
>         my $tickpos = $dx + ($flip ? $self->map_pt($stop - $i + $offset + 2) # WE MUST DO +2
>                                    : $self->map_pt($i + $offset));                                       
> 	    next if $tickpos < $left or $tickpos > $right;
176c187
< 	$gd->line($tickpos,$center-$a4,$tickpos,$center+$a4,$fg);
---
> 	    $gd->line($tickpos,$center-$a4,$tickpos,$center+$a4,$fg);
